# Mocks Module Tests

This directory contains tests for the Mocks module.

## Test Structure

### Unit Tests (`unit.test.js`)
- Tests all 13 mock endpoint functions with mocked axios responses
- Verifies correct HTTP methods, endpoints, and parameters
- Validates request headers and data structures
- Uses Jest mocks to simulate API responses
- **All 13 functions have comprehensive unit test coverage**

### Functional Tests (`functional.test.js`)
- Tests against the actual Postman API
- Creates, retrieves, updates, and deletes real mock servers
- Tests server response management
- Tests call logs retrieval
- Uses persisted test IDs from `test-ids.json`
- **17 functional test scenarios covering 11 of 13 endpoints**
- Note: Publish/unpublish tests are skipped (tests 14-15) due to API restrictions

## Running Tests

### Run all mocks tests:
```bash
npm test -- src/mocks/__tests__/
```

### Run only unit tests:
```bash
npm test -- src/mocks/__tests__/unit.test.js
```

### Run only functional tests:
```bash
npm test -- src/mocks/__tests__/functional.test.js
```

## Test Coverage

### Core Mock Operations (5 endpoints)
- ✅ GET `/mocks` - Get all mocks
- ✅ POST `/mocks` - Create a mock
- ✅ GET `/mocks/{mockId}` - Get a mock
- ✅ PUT `/mocks/{mockId}` - Update a mock
- ✅ DELETE `/mocks/{mockId}` - Delete a mock

### Mock Publishing & Call Logs (3 endpoints)
- ⏭️ POST `/mocks/{mockId}/publish` - Publish a mock (skipped in functional tests)
- ⏭️ DELETE `/mocks/{mockId}/unpublish` - Unpublish a mock (skipped in functional tests)
- ✅ GET `/mocks/{mockId}/call-logs` - Get mock call logs

### Mock Server Responses (5 endpoints)
- ✅ GET `/mocks/{mockId}/server-responses` - Get server responses
- ✅ POST `/mocks/{mockId}/server-responses` - Create server response
- ✅ GET `/mocks/{mockId}/server-responses/{serverResponseId}` - Get server response
- ✅ PUT `/mocks/{mockId}/server-responses/{serverResponseId}` - Update server response
- ✅ DELETE `/mocks/{mockId}/server-responses/{serverResponseId}` - Delete server response

## Functional Test Flow

1. **Setup**: Load test IDs and authenticate user
2. **Create Mock**: Create a new mock server in a collection (uses collection UID)
3. **Get Mocks**: Test retrieving all mocks and workspace-filtered mocks
4. **Get Mock**: Retrieve the created mock server
5. **Update Mock**: Update mock server name
6. **Error Handling**: Test 404 error for non-existent mock
7. **Server Responses**: Create, retrieve, update, and delete server responses
8. **Call Logs**: Retrieve call logs with and without filtering
9. **Cleanup**: Delete server response and mock server

**Note**: Tests use persisted IDs from `test-ids.json` to maintain state across test runs.

## Prerequisites for Functional Tests

- Valid `POSTMAN_API_KEY` environment variable
- Existing workspace ID in `test-ids.json`
- Existing collection ID in `test-ids.json`
- Active Postman account with appropriate permissions

## Notes

- Functional tests use the persisted collection from previous test runs
- Collection IDs must be converted to UIDs using string concatenation: `${userId}-${collectionId}` when creating mocks
- Mock server URLs are automatically generated by Postman
- Server responses must use 5xx status codes (500-599)
- Call logs have a retention period based on your Postman plan
- Publish/unpublish tests are skipped as they may require specific plan features or permissions
- Tests are designed to clean up after themselves by deleting created resources

